<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: EventMachine::Deferrable</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">EventMachine::Deferrable</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/em/deferrable_rb.html">
                lib/em/deferrable.rb
                </a>
        <br />
                <a href="../../files/lib/em/future_rb.html">
                lib/em/future.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000450">callback</a>&nbsp;&nbsp;
      <a href="#M000454">cancel_timeout</a>&nbsp;&nbsp;
      <a href="#M000451">errback</a>&nbsp;&nbsp;
      <a href="#M000458">fail</a>&nbsp;&nbsp;
      <a href="#M000459">future</a>&nbsp;&nbsp;
      <a href="#M000456">set_deferred_failure</a>&nbsp;&nbsp;
      <a href="#M000452">set_deferred_status</a>&nbsp;&nbsp;
      <a href="#M000455">set_deferred_success</a>&nbsp;&nbsp;
      <a href="#M000457">succeed</a>&nbsp;&nbsp;
      <a href="#M000453">timeout</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000459" class="method-detail">
        <a name="M000459"></a>

        <div class="method-heading">
          <a href="Deferrable.src/M000459.html" target="Code" class="method-signature"
            onclick="popupCode('Deferrable.src/M000459.html');return false;">
          <span class="method-name">future</span><span class="method-args">(arg, cb=nil, eb=nil, &amp;blk)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Evaluate arg (which may be an expression or a block). What&#8216;s the
class of arg? If arg is an ordinary expression, then return it. If arg is
deferrable (responds to :<a
href="Deferrable.html#M000452">set_deferred_status</a>), then look at the
arguments. If either <a href="Deferrable.html#M000450">callback</a> or <a
href="Deferrable.html#M000451">errback</a> are defined, then use them. If
neither are defined, then use the supplied block (if any) as the <a
href="Deferrable.html#M000450">callback</a>. Then return arg.
</p>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000450" class="method-detail">
        <a name="M000450"></a>

        <div class="method-heading">
          <a href="Deferrable.src/M000450.html" target="Code" class="method-signature"
            onclick="popupCode('Deferrable.src/M000450.html');return false;">
          <span class="method-name">callback</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Specify a block to be executed if and when the <a
href="Deferrable.html">Deferrable</a> object receives a status of
:succeeded. See <a href="Deferrable.html#M000452">set_deferred_status</a>
for more information.
</p>
<p>
Calling this method on a <a href="Deferrable.html">Deferrable</a> object
whose status is not yet known will cause the <a
href="Deferrable.html#M000450">callback</a> block to be stored on an
internal list. If you call this method on a <a
href="Deferrable.html">Deferrable</a> whose status is :succeeded, the block
will be executed immediately, receiving the parameters given to the prior
<a href="Deferrable.html#M000452">set_deferred_status</a> call.
</p>
        </div>
      </div>

      <div id="method-M000454" class="method-detail">
        <a name="M000454"></a>

        <div class="method-heading">
          <a href="Deferrable.src/M000454.html" target="Code" class="method-signature"
            onclick="popupCode('Deferrable.src/M000454.html');return false;">
          <span class="method-name">cancel_timeout</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Cancels an outstanding <a href="Deferrable.html#M000453">timeout</a> if
any. Undoes the action of <a href="Deferrable.html#M000453">timeout</a>.
</p>
        </div>
      </div>

      <div id="method-M000451" class="method-detail">
        <a name="M000451"></a>

        <div class="method-heading">
          <a href="Deferrable.src/M000451.html" target="Code" class="method-signature"
            onclick="popupCode('Deferrable.src/M000451.html');return false;">
          <span class="method-name">errback</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Specify a block to be executed if and when the <a
href="Deferrable.html">Deferrable</a> object receives a status of :failed.
See <a href="Deferrable.html#M000452">set_deferred_status</a> for more
information.
</p>
        </div>
      </div>

      <div id="method-M000458" class="method-detail">
        <a name="M000458"></a>

        <div class="method-heading">
          <a href="Deferrable.src/M000458.html" target="Code" class="method-signature"
            onclick="popupCode('Deferrable.src/M000458.html');return false;">
          <span class="method-name">fail</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Can&#8216;t get enough sugar
</p>
        </div>
      </div>

      <div id="method-M000456" class="method-detail">
        <a name="M000456"></a>

        <div class="method-heading">
          <a href="Deferrable.src/M000456.html" target="Code" class="method-signature"
            onclick="popupCode('Deferrable.src/M000456.html');return false;">
          <span class="method-name">set_deferred_failure</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Equivalent to <a
href="Deferrable.html#M000452">set_deferred_status</a>(:failed, &#8230;)
</p>
        </div>
      </div>

      <div id="method-M000452" class="method-detail">
        <a name="M000452"></a>

        <div class="method-heading">
          <a href="Deferrable.src/M000452.html" target="Code" class="method-signature"
            onclick="popupCode('Deferrable.src/M000452.html');return false;">
          <span class="method-name">set_deferred_status</span><span class="method-args">(status, *args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the &quot;disposition&quot; (status) of the <a
href="Deferrable.html">Deferrable</a> object. See also the large set of
sugarings for this method. Note that if you call this method without
arguments, no arguments will be passed to the callback/errback. If the user
has coded these with arguments, then the user code will throw an argument
exception. Implementors of deferrable classes <b>must</b> document the
arguments they will supply to user callbacks.
</p>
<p>
OBSERVE SOMETHING VERY SPECIAL here: you may call this method even on the
INSIDE of a <a href="Deferrable.html#M000450">callback</a>. This is very
useful when a previously-registered <a
href="Deferrable.html#M000450">callback</a> wants to change the parameters
that will be passed to subsequently-registered ones.
</p>
<p>
You may give either :succeeded or :failed as the status argument.
</p>
<p>
If you pass :succeeded, then all of the blocks passed to the object using
the <a href="Deferrable.html#M000450">callback</a> method (if any) will be
executed BEFORE the <a
href="Deferrable.html#M000452">set_deferred_status</a> method returns. All
of the blocks passed to the object using <a
href="Deferrable.html#M000451">errback</a> will be discarded.
</p>
<p>
If you pass :failed, then all of the blocks passed to the object using the
<a href="Deferrable.html#M000451">errback</a> method (if any) will be
executed BEFORE the <a
href="Deferrable.html#M000452">set_deferred_status</a> method returns. All
of the blocks passed to the object using # <a
href="Deferrable.html#M000450">callback</a> will be discarded.
</p>
<p>
If you pass any arguments to <a
href="Deferrable.html#M000452">set_deferred_status</a> in addition to the
status argument, they will be passed as arguments to any callbacks or
errbacks that are executed. It&#8216;s your responsibility to ensure that
the argument lists specified in your callbacks and errbacks match the
arguments given in calls to <a
href="Deferrable.html#M000452">set_deferred_status</a>, otherwise Ruby will
raise an ArgumentError.
</p>
<p>
&#8212; We&#8216;re shifting callbacks off and discarding them as we
execute them. This is valid because by definition callbacks are executed no
more than once. It also has the magic effect of permitting recursive calls,
which means that a <a href="Deferrable.html#M000450">callback</a> can call
<a href="Deferrable.html#M000452">set_deferred_status</a> and change the
parameters that will be sent to subsequent callbacks down the chain.
</p>
<p>
Changed @callbacks and @errbacks from push/shift to unshift/pop, per
suggestion by Kirk Haines, to work around the memory leak bug that still
exists in many Ruby versions.
</p>
<p>
Changed 15Sep07: after processing callbacks or errbacks, CLEAR the other
set of handlers. This gets us a little closer to the behavior of
Twisted&#8216;s &quot;deferred,&quot; which only allows status to be set
once. Prior to making this change, it was possible to &quot;<a
href="Deferrable.html#M000457">succeed</a>&quot; a <a
href="Deferrable.html">Deferrable</a> (triggering its callbacks), and then
immediately &quot;<a href="Deferrable.html#M000458">fail</a>&quot; it,
triggering its errbacks! That is clearly undesirable, but it&#8216;s just
as undesirable to raise an exception is status is set more than once on a
<a href="Deferrable.html">Deferrable</a>. The latter behavior would
invalidate the idiom of resetting arguments by setting status from within a
<a href="Deferrable.html#M000450">callback</a> or <a
href="Deferrable.html#M000451">errback</a>, but more seriously it would
cause spurious errors if a <a href="Deferrable.html">Deferrable</a> was
timed out and then an attempt was made to <a
href="Deferrable.html#M000457">succeed</a> it. See the comments under the
new method <a href="Deferrable.html#M000453">timeout</a>.
</p>
        </div>
      </div>

      <div id="method-M000455" class="method-detail">
        <a name="M000455"></a>

        <div class="method-heading">
          <a href="Deferrable.src/M000455.html" target="Code" class="method-signature"
            onclick="popupCode('Deferrable.src/M000455.html');return false;">
          <span class="method-name">set_deferred_success</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Equivalent to <a
href="Deferrable.html#M000452">set_deferred_status</a>(:succeeded, &#8230;)
</p>
        </div>
      </div>

      <div id="method-M000457" class="method-detail">
        <a name="M000457"></a>

        <div class="method-heading">
          <a href="Deferrable.src/M000457.html" target="Code" class="method-signature"
            onclick="popupCode('Deferrable.src/M000457.html');return false;">
          <span class="method-name">succeed</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
And still more sugar
</p>
        </div>
      </div>

      <div id="method-M000453" class="method-detail">
        <a name="M000453"></a>

        <div class="method-heading">
          <a href="Deferrable.src/M000453.html" target="Code" class="method-signature"
            onclick="popupCode('Deferrable.src/M000453.html');return false;">
          <span class="method-name">timeout</span><span class="method-args">(seconds)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Setting a <a href="Deferrable.html#M000453">timeout</a> on a <a
href="Deferrable.html">Deferrable</a> causes it to go into the failed state
after the Timeout expires (passing no arguments to the object&#8216;s
errbacks). Setting the status at any time prior to a call to the expiration
of the <a href="Deferrable.html#M000453">timeout</a> will cause the timer
to be cancelled.
</p>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>