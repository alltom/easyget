<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>parser (Thin::Runner)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre><span class="ruby-comment cmt"># File lib/thin/runner.rb, line 50</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parser</span>
      <span class="ruby-comment cmt"># NOTE: If you add an option here make sure the key in the +options+ hash is the</span>
      <span class="ruby-comment cmt"># same as the name of the command line option.</span>
      <span class="ruby-comment cmt"># +option+ keys are used to build the command line to launch other processes,</span>
      <span class="ruby-comment cmt"># see &lt;tt&gt;lib/thin/command.rb&lt;/tt&gt;.</span>
      <span class="ruby-ivar">@parser</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">OptionParser</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">opts</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">banner</span> = <span class="ruby-node">&quot;Usage: thin [options] #{self.class.commands.join('|')}&quot;</span>

        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;&quot;</span>
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;Server options:&quot;</span>

        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-a&quot;</span>, <span class="ruby-value str">&quot;--address HOST&quot;</span>, <span class="ruby-value str">&quot;bind to HOST address &quot;</span> <span class="ruby-operator">+</span>
                                        <span class="ruby-node">&quot;(default: #{@options[:address]})&quot;</span>)             { <span class="ruby-operator">|</span><span class="ruby-identifier">host</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:address</span>] = <span class="ruby-identifier">host</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-p&quot;</span>, <span class="ruby-value str">&quot;--port PORT&quot;</span>, <span class="ruby-node">&quot;use PORT (default: #{@options[:port]})&quot;</span>)          { <span class="ruby-operator">|</span><span class="ruby-identifier">port</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:port</span>] = <span class="ruby-identifier">port</span>.<span class="ruby-identifier">to_i</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-S&quot;</span>, <span class="ruby-value str">&quot;--socket FILE&quot;</span>, <span class="ruby-value str">&quot;bind to unix domain socket&quot;</span>)                    { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:socket</span>] = <span class="ruby-identifier">file</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-y&quot;</span>, <span class="ruby-value str">&quot;--swiftiply [KEY]&quot;</span>, <span class="ruby-value str">&quot;Run using swiftiply&quot;</span>)                       { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:swiftiply</span>] = <span class="ruby-identifier">key</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-A&quot;</span>, <span class="ruby-value str">&quot;--adapter NAME&quot;</span>, <span class="ruby-value str">&quot;Rack adapter to use (default: autodetect)&quot;</span>,
                                        <span class="ruby-node">&quot;(#{Rack::ADAPTERS.map{|(a,b)|a}.join(', ')})&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:adapter</span>] = <span class="ruby-identifier">name</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-R&quot;</span>, <span class="ruby-value str">&quot;--rackup FILE&quot;</span>, <span class="ruby-value str">&quot;Load a Rack config file instead of &quot;</span> <span class="ruby-operator">+</span>
                                       <span class="ruby-value str">&quot;Rack adapter&quot;</span>)                                  { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:rackup</span>] = <span class="ruby-identifier">file</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-c&quot;</span>, <span class="ruby-value str">&quot;--chdir DIR&quot;</span>, <span class="ruby-value str">&quot;Change to dir before starting&quot;</span>)                   { <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:chdir</span>] = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">dir</span>) }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(      <span class="ruby-value str">&quot;--stats PATH&quot;</span>, <span class="ruby-value str">&quot;Mount the Stats adapter under PATH&quot;</span>)             { <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:stats</span>] = <span class="ruby-identifier">path</span> }
        
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;&quot;</span>
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;Adapter options:&quot;</span>
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-e&quot;</span>, <span class="ruby-value str">&quot;--environment ENV&quot;</span>, <span class="ruby-value str">&quot;Framework environment &quot;</span> <span class="ruby-operator">+</span>                       
                                           <span class="ruby-node">&quot;(default: #{@options[:environment]})&quot;</span>)      { <span class="ruby-operator">|</span><span class="ruby-identifier">env</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:environment</span>] = <span class="ruby-identifier">env</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(      <span class="ruby-value str">&quot;--prefix PATH&quot;</span>, <span class="ruby-value str">&quot;Mount the app under PATH (start with /)&quot;</span>)       { <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:prefix</span>] = <span class="ruby-identifier">path</span> }
        
        <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Thin</span>.<span class="ruby-identifier">win?</span> <span class="ruby-comment cmt"># Daemonizing not supported on Windows</span>
          <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;&quot;</span>
          <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;Daemon options:&quot;</span>
                                                                                      
          <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-d&quot;</span>, <span class="ruby-value str">&quot;--daemonize&quot;</span>, <span class="ruby-value str">&quot;Run daemonized in the background&quot;</span>)              { <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:daemonize</span>] = <span class="ruby-keyword kw">true</span> }
          <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-l&quot;</span>, <span class="ruby-value str">&quot;--log FILE&quot;</span>, <span class="ruby-value str">&quot;File to redirect output &quot;</span> <span class="ruby-operator">+</span>                      
                                      <span class="ruby-node">&quot;(default: #{@options[:log]})&quot;</span>)                   { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:log</span>] = <span class="ruby-identifier">file</span> }
          <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-P&quot;</span>, <span class="ruby-value str">&quot;--pid FILE&quot;</span>, <span class="ruby-value str">&quot;File to store PID &quot;</span> <span class="ruby-operator">+</span>                            
                                      <span class="ruby-node">&quot;(default: #{@options[:pid]})&quot;</span>)                   { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:pid</span>] = <span class="ruby-identifier">file</span> }
          <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-u&quot;</span>, <span class="ruby-value str">&quot;--user NAME&quot;</span>, <span class="ruby-value str">&quot;User to run daemon as (use with -g)&quot;</span>)           { <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:user</span>] = <span class="ruby-identifier">user</span> }
          <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-g&quot;</span>, <span class="ruby-value str">&quot;--group NAME&quot;</span>, <span class="ruby-value str">&quot;Group to run daemon as (use with -u)&quot;</span>)         { <span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:group</span>] = <span class="ruby-identifier">group</span> }
                                                                                      
          <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;&quot;</span>
          <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;Cluster options:&quot;</span>                                             
                                                                                      
          <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-s&quot;</span>, <span class="ruby-value str">&quot;--servers NUM&quot;</span>, <span class="ruby-value str">&quot;Number of servers to start&quot;</span>)                  { <span class="ruby-operator">|</span><span class="ruby-identifier">num</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:servers</span>] = <span class="ruby-identifier">num</span>.<span class="ruby-identifier">to_i</span> }
          <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-o&quot;</span>, <span class="ruby-value str">&quot;--only NUM&quot;</span>, <span class="ruby-value str">&quot;Send command to only one server of the cluster&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">only</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:only</span>] = <span class="ruby-identifier">only</span> }
          <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-C&quot;</span>, <span class="ruby-value str">&quot;--config FILE&quot;</span>, <span class="ruby-value str">&quot;Load options from config file&quot;</span>)               { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:config</span>] = <span class="ruby-identifier">file</span> }
          <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(      <span class="ruby-value str">&quot;--all [DIR]&quot;</span>, <span class="ruby-value str">&quot;Send command to each config files in DIR&quot;</span>)      { <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:all</span>] = <span class="ruby-identifier">dir</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Thin</span>.<span class="ruby-identifier">linux?</span>
        <span class="ruby-keyword kw">end</span>
        
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;&quot;</span>
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;Tuning options:&quot;</span>
        
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-b&quot;</span>, <span class="ruby-value str">&quot;--backend CLASS&quot;</span>, <span class="ruby-value str">&quot;Backend to use, full classname&quot;</span>)              { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:backend</span>] = <span class="ruby-identifier">name</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-t&quot;</span>, <span class="ruby-value str">&quot;--timeout SEC&quot;</span>, <span class="ruby-value str">&quot;Request or command timeout in sec &quot;</span> <span class="ruby-operator">+</span>            
                                       <span class="ruby-node">&quot;(default: #{@options[:timeout]})&quot;</span>)              { <span class="ruby-operator">|</span><span class="ruby-identifier">sec</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:timeout</span>] = <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">to_i</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-f&quot;</span>, <span class="ruby-value str">&quot;--force&quot;</span>, <span class="ruby-value str">&quot;Force the execution of the command&quot;</span>)                  { <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:force</span>] = <span class="ruby-keyword kw">true</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(      <span class="ruby-value str">&quot;--max-conns NUM&quot;</span>, <span class="ruby-value str">&quot;Maximum number of connections &quot;</span> <span class="ruby-operator">+</span>
                                         <span class="ruby-node">&quot;(default: #{@options[:max_conns]})&quot;</span>,
                                         <span class="ruby-value str">&quot;Might require sudo to set higher then 1024&quot;</span>)  { <span class="ruby-operator">|</span><span class="ruby-identifier">num</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:max_conns</span>] = <span class="ruby-identifier">num</span>.<span class="ruby-identifier">to_i</span> } <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Thin</span>.<span class="ruby-identifier">win?</span>
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(      <span class="ruby-value str">&quot;--max-persistent-conns NUM&quot;</span>,
                                       <span class="ruby-value str">&quot;Maximum number of persistent connections&quot;</span>,
                                       <span class="ruby-node">&quot;(default: #{@options[:max_persistent_conns]})&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">num</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:max_persistent_conns</span>] = <span class="ruby-identifier">num</span>.<span class="ruby-identifier">to_i</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(      <span class="ruby-value str">&quot;--threaded&quot;</span>, <span class="ruby-value str">&quot;Call the Rack application in threads &quot;</span> <span class="ruby-operator">+</span>
                                    <span class="ruby-value str">&quot;[experimental]&quot;</span>)                                   { <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:threaded</span>] = <span class="ruby-keyword kw">true</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(      <span class="ruby-value str">&quot;--no-epoll&quot;</span>, <span class="ruby-value str">&quot;Disable the use of epoll&quot;</span>)                         { <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:no_epoll</span>] = <span class="ruby-keyword kw">true</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Thin</span>.<span class="ruby-identifier">linux?</span>
        
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;&quot;</span>
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;Common options:&quot;</span>

        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on_tail</span>(<span class="ruby-value str">&quot;-r&quot;</span>, <span class="ruby-value str">&quot;--require FILE&quot;</span>, <span class="ruby-value str">&quot;require the library&quot;</span>)                     { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:require</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">file</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on_tail</span>(<span class="ruby-value str">&quot;-D&quot;</span>, <span class="ruby-value str">&quot;--debug&quot;</span>, <span class="ruby-value str">&quot;Set debbuging on&quot;</span>)                               { <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:debug</span>] = <span class="ruby-keyword kw">true</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on_tail</span>(<span class="ruby-value str">&quot;-V&quot;</span>, <span class="ruby-value str">&quot;--trace&quot;</span>, <span class="ruby-value str">&quot;Set tracing on (log raw request/response)&quot;</span>)      { <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:trace</span>] = <span class="ruby-keyword kw">true</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on_tail</span>(<span class="ruby-value str">&quot;-h&quot;</span>, <span class="ruby-value str">&quot;--help&quot;</span>, <span class="ruby-value str">&quot;Show this message&quot;</span>)                               { <span class="ruby-identifier">puts</span> <span class="ruby-identifier">opts</span>; <span class="ruby-identifier">exit</span> }
        <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on_tail</span>(<span class="ruby-value str">'-v'</span>, <span class="ruby-value str">'--version'</span>, <span class="ruby-value str">&quot;Show version&quot;</span>)                                 { <span class="ruby-identifier">puts</span> <span class="ruby-constant">Thin</span><span class="ruby-operator">::</span><span class="ruby-constant">SERVER</span>; <span class="ruby-identifier">exit</span> }
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span></pre>
</body>
</html>